<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>sot-doc: ControllersFormulation.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pinocchio.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="MathJax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sot-doc
   &#160;<span id="projectnumber">0.0.1-dirty</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ControllersFormulation_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ControllersFormulation.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Controllers formulation {#b_controllers_information}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;\section NecessaryConditions Necessary constraints</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;\subsection SubSecDynamicModeling Dynamic modeling of a free-floating multi-body system</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The dynamic model of a free-floating multi-body system can be written this way:</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;\f[ M(q) \ddot{q} + N(q,\dot{q}) \dot{q}+G(q)=Su \f]</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;with \f$q\f$ the robot state variable, </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;\f$ M(q) \f$ the inertia matrix of the multi-body system, </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;\f$ N (q,\dot{q}) \f$ the matrix of the non-linear dynamical effect (Centrifugal and Coriolis forces) of the system motion, </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;\f$ G(q) \f$ the gravity, \f$u\f$ the control vector, and \f$ S \f$ the matrix mapping the control vector on the system (also called the selection matrix).</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;The current software library we are using to computate such quantities and theirs derivatives is Pinocchio 1. </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;Pinocchio include dynamical quantities such as angular momentum and its derivatives.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;\subsection SubSecContactModels Contact models</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;When considering a rigid contact model several constraints needs to be considered:</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; * No penetration in the ground</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; * No sliding</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;Both constraints generate inequalities at the contact points with respect to the state vector:</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;\f[ \Phi_{n,c} (q) \geq 0 \f]</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;\f[ \Phi_{t,c} (q) \geq 0 \f]</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;with \f$ \Phi_{n,c}(q) \f$ the normal force at contact point \f$ c \f$ expressed in the local reference frame of the contact point,</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;and \f$ \Phi_{t,c}(q) \f$ the tangential force at contact point \f$ c\f$ also expressed in the local reference frame of the contact point.</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;To avoid penetration velocity and acceleration of the points must be constrained too. Using differentiation we obtain:</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;\f[ C_n (q) \dot{q}  = 0 \f]</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;\f[ C_n(q) \ddot{q}+s_n(q,\dot{q})=0 \f]</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;The same derivation can be realized to avoid sliding:</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;\f[ C_t(q)\dot{q}=0 \f]</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;\f[ C_t(q)\ddot{q}+s_n(q,\dot{q})=0 \f]</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;Self-collisiion is usually avoiding by formulating an inequality constraint on the distance between two robot bodies. To do that the closest two points between two shapes are tracked. The distance between two bodies is obtained through a flavor of the FCL library.</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;\section SecFunctions Functions used to generate a robot behavior</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;\subsection SubFuncFormulatingTasks Formulating tasks </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;\subsubsection subsubdef Definition </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;Task \f$ (e) \f$ are using features \f$(s)\f$. Features might be end-effector posision (hands, feet), the robot center-of-mass, or the center-of-gravity of an object projected in the image. We assume that a function relates the current state of the robot typically the configuration, speed, acceleration to a feature. For instance, we may want to consider the Center-Of-Mass of a robot specified by a model \f$ robot\_model \f$</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;and a configuration vector \f$ q\f$ \f[ f_{CoM}:(robot\_model,q) \rightarrow c\f]</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;We further assume that this function is at least differentiable once. A task is then defined by the regulation between the feature depending on the current state </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;\f$ s(q) \f$ of the robot and a desired feature \f$s^*\f$:</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;\f[ e=s(q)−s^*\f]</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;\subsubsection subsubImposingTaskDyn Imposing the task dynamic</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;You can impose for instance that the task dynamic is an exponential decay:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;\f[ \dot{e}=−λe \f]</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;But we also have:</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;\f[ \dot{e}=\dot{s}(q)−\dot{s}^∗\f]</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;If the desired feature does not move we have </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;\f[ \dot{s}^∗=0 \f]</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;in addition we can remark that </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;\f[\dot{s}(q)=\frac{\delta s}{\delta q}\dot{q}=J(q)\dot{q} \f]</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;Thus</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;\f[ \dot{e}=J(q)\dot{q}−\dot{s}^∗ \f]</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;At a given time </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;\f$ t=k \Delta T \f$</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;a measurement of the feature </div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;\f$ \hat{s}(t) \f$ can give us:</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;\f[ \hat{e}(t)=\hat{s}(t)−s^∗(t) \f]</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;By posing </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;\f[ \hat{e}(t)=e(t) \f]</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;we have:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;\f[ \dot{e}(t)=−\lambda e(t)=−\lambda \hat{e}(t)= −\lambda ( \hat{s}(t)−s^*(t)) \f]</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;We will continue by dropping \f$ (t) \f$ for sake of clarity:</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;\f[ − \lambda ( \hat{s}− s^∗) = J(q)\dot{q} \f]</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;Therefore if \f$ J(q) \f$ is invertible we can find </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;\f$ \dot{q} \f$ using the following relationship:</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;\f[ \dot{q}=− \lambda J(q)^{−1}(\hat{s}−s^∗) \f]</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;In general \f$ J(q) \f$ is not square and then we have to use the Moore-Penrose pseudo inverse:</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;\f[ \dot{q}= −\lambda J(q)^+(\hat{s}−s^∗) \f]</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;But it can be also understood as the solution of the following optimization problem:</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;\f[ \begin{matrix}</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;argmin_{ \dot{q}} || \dot{q} || &amp; \\</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;s.t. &amp; − \lambda (\hat{s} - s^∗) =J(q)\dot{q} \\</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;\end{matrix}</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;\f]</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; * The library implementing the task formulation in velocity domain is [sot-core](http://github.com/stack-of-tasks/sot-core) (Hierarchy).</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; * The library implementing the task formulation in acceleration is [sot-dyninv](http://github.com/stack-of-tasks/sot-dyninv) (Hierarchy with inequalities).</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; * The library implementing the task formulation in torque is [sot-torque-control](http://github.com/stack-of-tasks/sot-torque-control) (Weighted sum).</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;\subsection SubsectionFormulatingInstantaneousControl Formulating instantaneous control as optimization problem</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;The task function is allowing a very versatile formulation including:</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; * Hierarchy of tasks: Each task at a level \f$ i\f$ cannot interfer with the control at level \f$i-1\f$.</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   This concept has been introduced by Nakamura \cite Nakamura:ijrr:87 extended by Siciliano in \cite Siciliano:icarrue:91 .</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; * Weighted problems:  Each task are at the same level i.e. they are all included in the same cost function, and they are weighted against each other.</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>ControllersFormulation.md</b></li>
    <li class="footer">Generated on Mon Apr 13 2020 16:10:43 for sot-doc by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
